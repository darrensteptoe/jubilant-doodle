/*
  styles-shell.css
  New layout shell for Field Path Engine.
  Loaded after styles.css — overrides layout only, never card/form/utility classes.
  All existing card, input, button, table, badge styles remain in styles.css untouched.
*/

/* ── FONT IMPORT ─────────────────────────────────────────── */
/* IBM Plex Sans + Mono loaded via <link> in HTML */
:root {
  --shell-font: 'IBM Plex Sans', var(--font-sans);
  --shell-mono: 'IBM Plex Mono', var(--font-mono);

  /* Layout dimensions */
  --topbar-h:    52px;
  --nav-w:       210px;
  --sidebar-w:   268px;

  /* New shell tokens (map to existing theme tokens) */
  --s-bg:        var(--bg);
  --s-panel:     var(--panel);
  --s-rule:      var(--rule);
  --s-text:      var(--text);
  --s-muted:     var(--text-muted);
  --s-accent:    var(--accent);
  --s-accent-dim: color-mix(in srgb, var(--accent) 12%, transparent);
  --s-ok:        var(--ok-fg);
  --s-ok-dim:    var(--ok-bg);
  --s-warn:      var(--warn-fg);
  --s-warn-dim:  var(--warn-bg);
  --s-bad:       var(--bad-fg);
  --s-bad-dim:   var(--bad-bg);
  --s-train:     #8b5cf6;
  --s-train-dim: rgba(139,92,246,0.1);
  --s-train-border: rgba(139,92,246,0.28);
}

/* ── RESET BODY FOR NEW LAYOUT ───────────────────────────── */
html, body { height: 100%; overflow: hidden; }
body { font-family: var(--shell-font); }

/* ── TOPBAR ──────────────────────────────────────────────── */
.topbar-new {
  position: fixed;
  top: 0; left: 0; right: 0;
  height: var(--topbar-h);
  background: var(--s-panel);
  border-bottom: 1px solid var(--s-rule);
  display: flex;
  align-items: center;
  padding: 0 14px;
  gap: 12px;
  z-index: 200;
  font-family: var(--shell-font);
}

.brand-new {
  display: flex;
  align-items: center;
  gap: 7px;
  flex-shrink: 0;
}
.brand-name-new {
  font-size: 13px;
  font-weight: 600;
  color: var(--s-text);
  white-space: nowrap;
}
.chip-new {
  font-family: var(--shell-mono);
  font-size: 10px;
  font-weight: 500;
  padding: 2px 6px;
  border-radius: 3px;
  background: color-mix(in srgb, var(--s-rule) 60%, var(--s-panel));
  border: 1px solid var(--s-rule);
  color: var(--s-muted);
}
.chip-new.chip-status { cursor: default; }

.topbar-center {
  flex: 1;
  display: flex;
  align-items: center;
  gap: 7px;
  max-width: 380px;
}
.scenario-label-new {
  font-size: 11px;
  color: var(--s-muted);
  white-space: nowrap;
  flex-shrink: 0;
}
.scenario-input-new {
  flex: 1;
  background: var(--s-bg);
  border: 1px solid var(--s-rule);
  border-radius: 5px;
  color: var(--s-text);
  font-family: var(--shell-font);
  font-size: 12px;
  padding: 5px 8px;
  outline: none;
  transition: border-color 0.15s;
}
.scenario-input-new:focus { border-color: var(--s-accent); }

.topbar-right {
  margin-left: auto;
  display: flex;
  align-items: center;
  gap: 7px;
  flex-shrink: 0;
}

/* Training toggle pill */
.toggle-pill {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 5px 10px;
  border-radius: 5px;
  border: 1px solid var(--s-rule);
  background: var(--s-bg);
  cursor: pointer;
  font-size: 12px;
  color: var(--s-muted);
  transition: all 0.15s;
  user-select: none;
  white-space: nowrap;
}
.toggle-pill:hover { border-color: color-mix(in srgb, var(--s-rule) 60%, var(--s-text)); color: var(--s-text); }
.toggle-dot-new {
  width: 7px; height: 7px;
  border-radius: 50%;
  background: var(--s-muted);
  transition: background 0.15s;
  flex-shrink: 0;
}

/* When training checkbox is checked → sibling .toggle-dot-new and parent .toggle-pill change */
body.training .toggle-pill:has(#toggleTraining) {
  border-color: var(--s-train-border);
  color: var(--s-train);
  background: var(--s-train-dim);
}
body.training .toggle-pill:has(#toggleTraining) .toggle-dot-new {
  background: var(--s-train);
}

.btn-top-new {
  padding: 5px 10px;
  border-radius: 5px;
  border: 1px solid var(--s-rule);
  background: transparent;
  color: var(--s-muted);
  font-family: var(--shell-font);
  font-size: 12px;
  cursor: pointer;
  transition: all 0.15s;
  white-space: nowrap;
}
.btn-top-new:hover { border-color: color-mix(in srgb, var(--s-rule) 60%, var(--s-text)); color: var(--s-text); }
.btn-top-new.btn-top-danger { color: var(--s-bad); border-color: color-mix(in srgb, var(--s-bad) 30%, var(--s-rule)); }
.btn-top-new.btn-top-danger:hover { background: var(--s-bad-dim); }

.divider-new {
  width: 1px; height: 20px;
  background: var(--s-rule);
  flex-shrink: 0;
}

/* ── APP SHELL ───────────────────────────────────────────── */
.app-shell {
  display: flex;
  height: 100vh;
  padding-top: var(--topbar-h);
  overflow: hidden;
}

/* Kill the old shell layout */
.shell { display: contents; }

/* ── STAGE NAV (LEFT RAIL) ───────────────────────────────── */
.stage-nav-new {
  width: var(--nav-w);
  flex-shrink: 0;
  background: var(--s-panel);
  border-right: 1px solid var(--s-rule);
  display: flex;
  flex-direction: column;
  overflow-y: auto;
  padding: 10px 0 16px;
}

.nav-group-label-new {
  font-size: 9px;
  font-weight: 600;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  color: color-mix(in srgb, var(--s-muted) 60%, transparent);
  padding: 10px 14px 4px;
}

.nav-item-new {
  display: flex;
  align-items: center;
  gap: 9px;
  padding: 7px 12px 7px 14px;
  cursor: pointer;
  border: none;
  background: transparent;
  border-left: 2px solid transparent;
  text-align: left;
  width: 100%;
  transition: background 0.1s;
  font-family: var(--shell-font);
}
.nav-item-new:hover { background: color-mix(in srgb, var(--s-rule) 40%, transparent); }
.nav-item-new.active {
  background: var(--s-accent-dim);
  border-left-color: var(--s-accent);
}
.nav-item-new.active .nav-label-new { color: var(--s-accent); font-weight: 500; }

/* status variants */
.nav-item-new.nav-ok   .nav-num-new { background: var(--s-ok-dim);   color: var(--s-ok);   border-color: color-mix(in srgb, var(--s-ok)  30%, transparent); }
.nav-item-new.nav-warn .nav-num-new { background: var(--s-warn-dim); color: var(--s-warn); border-color: color-mix(in srgb, var(--s-warn) 30%, transparent); }
.nav-item-new.nav-bad  .nav-num-new { background: var(--s-bad-dim);  color: var(--s-bad);  border-color: color-mix(in srgb, var(--s-bad)  30%, transparent); }

.nav-num-new {
  width: 20px; height: 20px;
  border-radius: 50%;
  border: 1px solid var(--s-rule);
  background: var(--s-bg);
  color: color-mix(in srgb, var(--s-muted) 70%, transparent);
  font-family: var(--shell-mono);
  font-size: 9px;
  font-weight: 500;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  transition: all 0.15s;
}
.nav-label-new {
  font-size: 12px;
  color: var(--s-muted);
  flex: 1;
  transition: color 0.1s;
}
.nav-sep-new {
  height: 1px;
  background: var(--s-rule);
  margin: 8px 0;
}

/* ── MAIN CONTENT AREA ───────────────────────────────────── */
.stage-main-new {
  flex: 1;
  min-width: 0;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  background: var(--s-bg);
}

/* Each stage is a full-height scrollable panel */
.stage-new {
  display: none;
  flex-direction: column;
  height: 100%;
  overflow: hidden;
}
.stage-new.active-stage {
  display: flex;
}

/* Stage header (sticky) */
.stage-header-new {
  flex-shrink: 0;
  padding: 14px 20px 12px;
  background: var(--s-panel);
  border-bottom: 1px solid var(--s-rule);
}
.stage-meta-new {
  display: flex;
  align-items: center;
  gap: 9px;
  margin-bottom: 3px;
}
.stage-tag-new {
  font-family: var(--shell-mono);
  font-size: 9px;
  font-weight: 500;
  letter-spacing: 0.06em;
  text-transform: uppercase;
  color: var(--s-muted);
  background: color-mix(in srgb, var(--s-rule) 50%, transparent);
  padding: 2px 7px;
  border-radius: 3px;
}
.stage-title-new {
  font-size: 15px;
  font-weight: 600;
  color: var(--s-text);
}
.stage-sub-new {
  font-size: 12px;
  color: var(--s-muted);
  margin: 0 0 10px;
  line-height: 1.5;
}

/* Stage body — scrollable */
.stage-body-new {
  flex: 1;
  overflow-y: auto;
  padding: 16px 20px 24px;
  display: flex;
  flex-direction: column;
  gap: 14px;
}

/* Cards inside stage body need spacing reset */
.stage-body-new .card + .card { margin-top: 0; }
.stage-body-new .card { margin-top: 0; }

/* Keep the old left/right/rail sections from affecting layout */
.left, .right { display: contents; }
.rail { display: contents; }

/* ── TRAINING PANEL ──────────────────────────────────────── */
.training-panel-new {
  background: var(--s-train-dim);
  border: 1px solid var(--s-train-border);
  border-radius: 8px;
  overflow: hidden;
  margin-bottom: 2px;
}

/* Hidden by default — shown when body.training is active */
.training-panel-new { display: none; }
body.training .training-panel-new { display: block; }

.training-hd-new {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 9px 13px;
  cursor: pointer;
  user-select: none;
}
.training-title-new {
  font-size: 11px;
  font-weight: 600;
  letter-spacing: 0.05em;
  text-transform: uppercase;
  color: var(--s-train);
  flex: 1;
}
.training-chev-new {
  color: var(--s-train);
  opacity: 0.6;
  font-size: 10px;
  transition: transform 0.2s;
}
.training-panel-new.collapsed .training-chev-new { transform: rotate(-90deg); }
.training-panel-new.collapsed .training-bd-new { display: none; }

.training-bd-new {
  padding: 0 13px 13px;
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
}
.training-col-new {
  display: flex;
  flex-direction: column;
  gap: 7px;
}
.training-sec-title-new {
  font-size: 9px;
  font-weight: 700;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  color: var(--s-train);
  opacity: 0.75;
}
.training-bd-new p,
.training-bd-new li {
  font-size: 12px;
  color: var(--s-muted);
  line-height: 1.55;
}
.training-bd-new ul {
  padding-left: 14px;
  display: flex;
  flex-direction: column;
  gap: 3px;
  margin: 0;
}
.training-bd-new strong { color: var(--s-train); font-weight: 500; }
.training-rule-new {
  background: color-mix(in srgb, var(--s-panel) 80%, var(--s-bg));
  border: 1px solid var(--s-rule);
  border-radius: 5px;
  padding: 7px 10px;
  font-size: 11px;
  color: var(--s-muted);
  font-family: var(--shell-mono);
  line-height: 1.55;
  white-space: pre-line;
}
.training-caution-new {
  background: var(--s-warn-dim);
  border: 1px solid color-mix(in srgb, var(--s-warn) 30%, transparent);
  border-radius: 5px;
  padding: 7px 10px;
  font-size: 11.5px;
  color: var(--s-warn);
  line-height: 1.45;
}
.training-caution-new::before { content: "⚠  "; }

/* ── RESULTS SIDEBAR (RIGHT) ─────────────────────────────── */
.results-sidebar-new {
  width: var(--sidebar-w);
  flex-shrink: 0;
  background: var(--s-panel);
  border-left: 1px solid var(--s-rule);
  display: flex;
  flex-direction: column;
  overflow-y: auto;
}

.sidebar-section-new {
  padding: 13px 14px;
  border-bottom: 1px solid var(--s-rule);
  flex-shrink: 0;
}
.sidebar-label-new {
  font-size: 9px;
  font-weight: 700;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  color: color-mix(in srgb, var(--s-muted) 70%, transparent);
  margin-bottom: 9px;
  display: block;
}

/* Win stats */
.win-stat-new {
  display: flex;
  flex-direction: column;
  gap: 1px;
  padding: 7px 0;
  border-bottom: 1px solid color-mix(in srgb, var(--s-rule) 50%, transparent);
}
.win-stat-new:last-child { border-bottom: none; }
.win-stat-label-new { font-size: 10px; color: var(--s-muted); }
.win-stat-val-new {
  font-family: var(--shell-mono);
  font-size: 19px;
  font-weight: 500;
  color: var(--s-text);
  line-height: 1.15;
}
.win-stat-sub-new { font-size: 10px; color: color-mix(in srgb, var(--s-muted) 70%, transparent); }

/* MC probability */
.mc-prob-row-new {
  display: flex;
  align-items: baseline;
  gap: 7px;
  margin-bottom: 6px;
}
.mc-prob-val-new {
  font-family: var(--shell-mono);
  font-size: 26px;
  font-weight: 500;
  color: var(--s-text);
  line-height: 1;
}
.mc-prob-sub-new { font-size: 11px; color: var(--s-muted); }
.prob-bar-new {
  height: 5px;
  background: color-mix(in srgb, var(--s-rule) 80%, transparent);
  border-radius: 3px;
  overflow: hidden;
  margin-bottom: 5px;
}
.prob-fill-new {
  height: 100%;
  border-radius: 3px;
  background: var(--s-accent);
  transition: width 0.5s ease;
}

.viz-track{fill: color-mix(in srgb, var(--s-rule) 80%, transparent)}
.viz-marker{fill: var(--s-accent)}
.viz-zero{stroke: color-mix(in srgb, var(--s-muted) 55%, transparent); stroke-width: 1; stroke-dasharray: 3 3}
.viz-bar{fill: color-mix(in srgb, var(--s-text) 16%, transparent)}
.viz-winshade{fill: color-mix(in srgb, var(--s-accent) 10%, transparent)}
.prob-range-new {
  display: flex;
  justify-content: space-between;
  font-size: 10px;
  color: var(--s-muted);
  margin-bottom: 6px;
}
.mc-meta-new { font-size: 10px; color: color-mix(in srgb, var(--s-muted) 65%, transparent); margin-top: 4px; }

/* KV mini rows in sidebar */
.kv-mini-new {
  display: flex;
  align-items: baseline;
  justify-content: space-between;
  gap: 8px;
  padding: 4px 0;
  border-bottom: 1px solid color-mix(in srgb, var(--s-rule) 40%, transparent);
  font-size: 11px;
}
.kv-mini-new:last-child { border-bottom: none; }
.kv-mini-new span:first-child { color: var(--s-muted); }
.kv-mini-new span:last-child {
  font-family: var(--shell-mono);
  font-size: 11px;
  color: var(--s-text);
  text-align: right;
}
.dim-text { color: color-mix(in srgb, var(--s-muted) 60%, transparent) !important; font-size: 10px !important; }

/* ── CARD-HEAD VISIBILITY FIX ────────────────────────────── */
/* Original styles.css sets .card-head { display:none } as a legacy alias.
   We want card headers visible in new layout. */
.stage-body-new .card-head { display: flex !important; }

/* Rewrite card-header padding to fit tighter stage layout */
.stage-body-new .card-header {
  padding: 10px 14px 9px;
}
.stage-body-new .card-body,
.stage-body-new .card-body-inner {
  padding: 13px 14px;
}

/* ── SCROLLBARS ──────────────────────────────────────────── */
.stage-nav-new::-webkit-scrollbar,
.stage-body-new::-webkit-scrollbar,
.results-sidebar-new::-webkit-scrollbar { width: 5px; }
.stage-nav-new::-webkit-scrollbar-track,
.stage-body-new::-webkit-scrollbar-track,
.results-sidebar-new::-webkit-scrollbar-track { background: transparent; }
.stage-nav-new::-webkit-scrollbar-thumb,
.stage-body-new::-webkit-scrollbar-thumb,
.results-sidebar-new::-webkit-scrollbar-thumb {
  background: color-mix(in srgb, var(--s-rule) 80%, transparent);
  border-radius: 3px;
}

/* ── RESPONSIVE ─────────────────────────────────────────── */
/* Never hide the right sidebar. On narrow viewports it remains visible. */
@media (max-width: 780px) {
  .stage-nav-new { width: 48px; }
  .nav-label-new, .nav-group-label-new, .nav-sep-new + .nav-group-label-new { display: none; }
}
